---
search:
  boost: 2
---

# 可扩展性和弹性 (Scalability & Resilience)

LangGraph Platform 旨在随您的工作负载水平扩展。服务的每个实例都是无状态的，并且不保留内存中的任何资源。该服务旨在优雅地处理添加或删除新实例的情况，包括硬关机情况。

## 服务器可扩展性 (Server scalability)

当您向服务添加更多实例时，只要在其前面放置了适当的负载均衡器机制，它们就会分担 HTTP 负载。在大多数部署模式中，我们会自动为服务配置负载均衡器。在“无控制平面的自托管”模式下，您有责任添加负载均衡器。由于实例是无状态的，任何负载均衡策略都可以工作，不需要也不建议会话粘性。服务器的任何实例都可以与任何队列实例通信（通过 Redis PubSub），这意味着取消或流式传输正在进行的运行的请求可以由任何任意实例处理。

## 队列可扩展性 (Queue scalability)

当您向服务添加更多实例时，它们将线性增加运行吞吐量，因为每个实例配置为处理特定数量的并发运行（默认为 10）。每个运行的每次尝试都将由单个实例处理，并通过 Postgres 的 MVCC 模型强制执行一次性语义（有关崩溃弹性的详细信息，请参阅下文）。由于瞬态数据库错误而失败的尝试最多重试 3 次。我们不使用长期存在的事务或锁，这使我们能够更有效地利用 Postgres 资源。

## 弹性 (Resilience)

当队列实例正在处理运行时，该队列工作者将在 Redis 中记录定期心跳时间戳。

收到正常关机请求 (SIGINT) 时，实例进入关机模式，该模式：

- 停止接受新的 HTTP 请求
- 给任何正在进行的运行有限的时间来完成（如果未完成，它将被放回队列中）
- 停止实例从队列中提取更多运行

如果由于服务器崩溃或基础设施故障而发生硬关机，任何正在进行的运行都将被内部清理任务拾取，该任务会查找已超出心跳窗口的正在进行的运行。清理程序每 2 分钟运行一次，并将运行放回队列，以便另一个实例拾取它们。

## Postgres 弹性 (Postgres resilience)

对于我们管理 Postgres 数据库的部署模式，我们有定期备份和持续复制的备用副本以进行自动故障转移。此 Postgres 配置仅在 [Cloud SaaS 部署选项](../concepts/langgraph_cloud.md) 中可用于 [`Production` 部署类型](../concepts/langgraph_control_plane.md#deployment-types)。

与 Postgres 的所有通信都实现了针对可重试错误的重试。如果 Postgres 暂时不可用，例如在数据库重启期间，大多数/所有流量应该继续成功。Postgres 的长时间故障将导致 LangGraph Server 不可用。

## Redis 弹性 (Redis resilience)

所有需要持久存储的数据都存储在 Postgres 中，而不是 Redis 中。Redis 仅用于临时元数据以及实例之间的通信。因此，我们不对 Redis 提出持久性要求。

与 Redis 的所有通信都实现了针对可重试错误的重试。如果 Redis 暂时不可用，例如在数据库重启期间，大多数/所有流量应该继续成功。Redis 的长时间故障将导致 LangGraph Server 不可用。
